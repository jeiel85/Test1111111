<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì°¬ì–‘ ì•…ë³´ ì°¾ê¸° ì™„ì„±íŒ ğŸµ</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background-color: #f5f5f5; display: flex; flex-direction: column; height: 100vh; }
        header { background-color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 18px; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #ddd; }
        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 80px; }
        textarea { width: 100%; height: 150px; border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 16px; box-sizing: border-box; resize: none; }
        
        /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ (ê°€ë¡œ ë°°ì¹˜ìš©) */
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        
        .btn-search { 
            flex: 2; /* ê³µê°„ì„ 2ë°° ë” ì°¨ì§€í•¨ */
            padding: 15px; background-color: #0070f3; color: white; 
            border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; 
        }
        
        .btn-reset { 
            flex: 1; /* ê³µê°„ì„ 1ë§Œí¼ ì°¨ì§€í•¨ */
            padding: 15px; background-color: #e0e0e0; color: #333; 
            border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; 
        }

        .result-area { margin-top: 30px; }
        .sheet-music-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
        .sheet-music-card img { width: 100%; height: auto; border-radius: 4px; min-height: 100px; background: #f0f0f0; }
        .sheet-title { margin-bottom: 10px; font-weight: bold; color: #333; text-align: left; }
        .error-msg { color: red; font-size: 14px; margin-top: 5px; }
        
        /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 15px;
            border-top: 1px solid #eee;
            display: flex; justify-content: center;
            display: none; 
        }
        .btn-download-all {
            width: 100%; padding: 15px;
            background-color: #28a745; color: white; border: none; border-radius: 8px;
            font-size: 18px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

    <header>ì´ë²ˆ ì£¼ ì°¬ì–‘ ì½˜í‹° ğŸ¶</header>

    <main>
        <div style="background: white; padding: 20px; border-radius: 12px;">
            <h3>ê³¡ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”</h3>
            <textarea id="song-input" placeholder="ì˜ˆ:&#13;&#10;276 í–‡ì‚´ë³´ë‹¤ ë°ê²Œ&#13;&#10;123 ë‹¹ì‹ ì€ ì§€ê¸ˆ ì–´ë””ë¡œ"></textarea>
            
            <div class="btn-group">
                <button class="btn-reset" onclick="resetAll()">ì´ˆê¸°í™” ğŸ”„</button>
                <button class="btn-search" onclick="startSearch()">ì•…ë³´ ì°¾ê¸° ğŸ”</button>
            </div>
        </div>

        <div id="result-container" class="result-area"></div>
    </main>

    <div class="bottom-bar" id="download-bar">
        <button class="btn-download-all" onclick="downloadAll()">ì „ì²´ ì•…ë³´ ìˆœì„œëŒ€ë¡œ ì €ì¥ ğŸ“¥</button>
    </div>

    <script>
        const EXTENSIONS = ['.jpg', '.png', '.gif', '.bmp', '.jpeg'];
        let foundImages = [];

        // --- ìƒˆë¡œ ì¶”ê°€ëœ ì´ˆê¸°í™” í•¨ìˆ˜ ---
        function resetAll() {
            // 1. ì…ë ¥ì°½ ë¹„ìš°ê¸°
            document.getElementById('song-input').value = "";
            // 2. ê²°ê³¼ í™”ë©´ ë¹„ìš°ê¸°
            document.getElementById('result-container').innerHTML = "";
            // 3. ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            document.getElementById('download-bar').style.display = 'none';
            // 4. ì…ë ¥ì°½ì— ì»¤ì„œ ê¹œë¹¡ì´ê²Œ í•˜ê¸° (ë°”ë¡œ ë¶™ì—¬ë„£ê¸° ì¢‹ê²Œ)
            document.getElementById('song-input').focus();
        }

        function startSearch() {
            const inputText = document.getElementById('song-input').value;
            const resultContainer = document.getElementById('result-container');
            const downloadBar = document.getElementById('download-bar');
            
            resultContainer.innerHTML = ""; 
            foundImages = []; 
            downloadBar.style.display = 'none'; 

            const lines = inputText.split('\n').filter(line => line.trim() !== "");
            if (lines.length === 0) return alert("ê³¡ ë¦¬ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            lines.forEach((line, index) => {
                const match = line.match(/^(\d+)/); 
                if (match) {
                    const songNumber = match[1];
                    const songTitle = line.substring(songNumber.length).trim();
                    
                    const card = document.createElement('div');
                    card.className = 'sheet-music-card';
                    card.innerHTML = `<div class="sheet-title">${index + 1}. No. ${songNumber} ${songTitle}</div>`;
                    
                    const imgTag = document.createElement('img');
                    imgTag.alt = `${songNumber} ì•…ë³´ ë¡œë”©ì¤‘...`;
                    card.appendChild(imgTag);
                    resultContainer.appendChild(card);

                    tryLoadImage(imgTag, songNumber, 0, (finalSrc) => {
                        const fileExt = finalSrc.substring(finalSrc.lastIndexOf('.'));
                        const fileName = `${String(index + 1).padStart(2, '0')}ë²ˆ_${songNumber}${fileExt}`;
                        
                        foundImages[index] = { url: finalSrc, name: fileName };

                        const foundCount = foundImages.filter(item => item !== undefined).length;
                        if (foundCount > 0 && foundCount === lines.length) {
                             downloadBar.style.display = 'flex';
                        }
                    });
                }
            });
        }

        function tryLoadImage(imgElement, songNum, extIndex, onSuccess) {
            if (extIndex >= EXTENSIONS.length) {
                imgElement.alt = "âŒ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                imgElement.parentElement.innerHTML += `<p class="error-msg">âš ï¸ íŒŒì¼ ì—†ìŒ (jpg, png, gif ë“± í™•ì¸ í•„ìš”)</p>`;
                return;
            }

            const currentExt = EXTENSIONS[extIndex];
            const trySrc = `images/${songNum}${currentExt}`;

            const tempImg = new Image();
            tempImg.onload = function() {
                imgElement.src = trySrc;
                imgElement.alt = `${songNum} ì•…ë³´`;
                onSuccess(trySrc); 
            };
            tempImg.onerror = function() {
                // ì‹¤íŒ¨ ì‹œ ë‹¤ìŒ í™•ì¥ì ì‹œë„ (ì¬ê·€)
                tryLoadImage(imgElement, songNum, extIndex + 1, onSuccess);
            };
            tempImg.src = trySrc; 
        }

        function downloadAll() {
            if (foundImages.length === 0) return alert("ì €ì¥í•  ì•…ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
            if (!confirm(`${foundImages.length}ê°œì˜ ì•…ë³´ë¥¼ ìˆœì„œëŒ€ë¡œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(íŒì—… ì°¨ë‹¨ì´ í•´ì œë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤)`)) return;

            foundImages.forEach((imgInfo, idx) => {
                if(!imgInfo) return; 
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = imgInfo.url;
                    link.download = imgInfo.name; 
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }, idx * 500); 
            });
        }
    </script>
</body>
</html>

